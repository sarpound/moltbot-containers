# =============================================================================
# Caddy - Reverse proxy for Moltbot
# =============================================================================
# ใช้สำหรับ Local Network (LAN) โดยเฉพาะ
# เข้าใช้งานผ่าน: https://192.168.1.5 หรือ https://localhost
# =============================================================================

# Global options
{
    # ปิด Admin API เพื่อความปลอดภัย
    admin off
}

# -----------------------------------------------------------------------------
# HTTPS server (รับทั้ง IP เครื่อง และ Localhost)
# -----------------------------------------------------------------------------
192.168.1.5, localhost, 127.0.0.1 {
    # ใช้ Certificate แบบสร้างเอง (Self-signed) สำหรับใช้ภายใน
    tls internal

    # บีบอัดข้อมูลเพื่อให้โหลดเร็วขึ้น
    encode gzip zstd

    # เพิ่ม Security Headers เพื่อความปลอดภัย
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Referrer-Policy "strict-origin-when-cross-origin"
        -Server
    }

    # ส่งต่อ Traffic ไปยัง Moltbot
    reverse_proxy moltbot:18789 {
        # ส่ง Header สำคัญเพื่อให้ Moltbot รู้ว่าเป็น HTTPS และมาจาก IP ไหน
        header_up X-Forwarded-Proto https
        header_up X-Forwarded-Port 443
        header_up X-Real-IP {remote_host}
    }
}

# -----------------------------------------------------------------------------
# HTTP (port 80) — บังคับ redirect ไป HTTPS อัตโนมัติ
# -----------------------------------------------------------------------------
:80 {
    redir https://{host}{uri} permanent
}
